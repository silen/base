<extend name="Public/base"/>

<block name="nav">
    <div class="am-cf am-padding">
        <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">推荐({$rInfo.title})</strong> /
            <small>内容{$id ? '修改' : '添加'}</small>
        </div>
    </div>

</block>


<block name="body">
    <hr/>

    <div class="am-g">

        <div class="am-u-sm-12 am-u-md-4 am-u-md-push-8">
            <div class="am-panel am-panel-default">
                <div class="am-panel-bd">
                    <div class="am-g">
                        <div class="am-u-md-8">
                            <img <if condition="$thumb eq ''">style="display:none"</if> class="thumb am-u-md-8" src="{$thumb}">
                        </div>
                        <audio <if condition="$audio eq ''">style="display:none"</if> class="audio" src="{$audio}" autoplay></audio>
                    </div>
                </div>
            </div>

        </div>

        <div class="am-u-sm-12 am-u-md-8 am-u-md-pull-4">
            <form class="am-form am-form-horizontal" method="post" id="ajaxForm">
                <input type="hidden" value="{$id}" name="id">
                <input type="hidden" value="{$rInfo.id}" name="rid">

                <div class="am-form-group">
                    <label class="am-u-sm-3 am-form-label">所属推荐位</label>

                    <div class="am-u-sm-9">
                        {$rInfo.title}
                    </div>
                </div>
                <div class="am-form-group">
                    <label class="am-u-sm-3 am-form-label">名称</label>

                    <div class="am-u-sm-9">
                        <input type="text" value="{$title}" name="title" placeholder="名称">
                        <small></small>
                    </div>
                </div>
                <div class="am-form-group">
                    <label  class="am-u-sm-3 am-form-label">链接</label>

                    <div class="am-u-sm-9">
                        <input type="text" value="{$url}" name="url" placeholder="链接">
                        <small></small>
                    </div>
                </div>
                <div class="am-form-group">
                    <label  class="am-u-sm-3 am-form-label">排序</label>

                    <div class="am-u-sm-9">
                        <input type="text" value="{$sort}" name="sort" placeholder="排序">
                        <small></small>
                    </div>
                </div>
                <div class="am-form-group">
                    <label  class="am-u-sm-3 am-form-label">图片</label>

                    <div class="am-u-sm-9">
                        <input type="text" style="float:left;width: 500px;" value="{$thumb}" name="thumb" placeholder=""> <input id="thumb" type="file" data-url="{:U('tool/upload')}" style="float:left;width: 68px;"  multiple>

                    </div>
                </div>
                <div class="am-form-group">
                    <label  class="am-u-sm-3 am-form-label">音频</label>

                    <div class="am-u-sm-9">
                        <input type="text" style="float:left;width: 500px;" value="{$audio}" name="audio" placeholder=""> <input id="audio" type="file" data-url="{:U('tool/upload')}" style="float:left;width: 68px;"  multiple>

                    </div>
                </div>
                <div class="am-form-group">
                    <label  class="am-u-sm-3 am-form-label">简介</label>

                    <div class="am-u-sm-9">
                        <textarea name="desc">{$desc}</textarea>

                    </div>
                </div>
                <div class="am-form-group">

                    <label  class="am-u-sm-3 am-form-label">日期</label>

                    <div class="am-u-sm-9">
                        <div class="am-u-sm-5" style="float:left;">
                            开始时间

                            <input type="text" class="am-form-field" style="width: 200px;  display:inline" value="{$starttime|date='Y-m-d',###}" name="starttime" placeholder="日历组件" data-am-datepicker readonly required />
                        </div>

                        <div class="am-u-sm-6" style="float:left;">
                            结束时间
                            <input type="text" class="am-form-field" style="width: 200px;  display:inline" value="{$endtime|date='Y-m-d',###}" name="endtime" placeholder="日历组件" data-am-datepicker readonly required />
                        </div>
                    </div>
                </div>

                <div class="am-form-group">
                    <label class="am-u-sm-3 am-form-label">状态</label>

                    <div class="am-u-sm-9">
                        <div class="am-btn-group" data-am-button>
                            <label class="am-btn am-btn-default am-btn-xs">
                                <input type="radio" value="1" name="status" id="option1">发布
                            </label>
                            <label class="am-btn am-btn-default am-btn-xs">
                                <input type="radio" value="2" name="status" id="option2">禁用
                            </label>
                            <label class="am-btn am-btn-default am-btn-xs">
                                <input type="radio" value="3" name="status" id="option3">存档
                            </label>

                        </div>
                    </div>
                </div>
                <div class="am-form-group">
                    <div class="am-u-sm-9 am-u-sm-push-3">
                        <button type="button" class="am-btn am-btn-primary" onclick="addData($('#ajaxForm'))">保存修改
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</block>
<block name="script">
    <script src="__JS__/jquery.ui.widget.js"></script>
    <script src="__JS__/jquery.iframe-transport.js"></script>
    <script src="__JS__/jquery.fileupload.js"></script>

    <script>
        var $id = "{$id}";
        var $status = "{$status ? $status : 1}";
        $msg = $id ? "修改" : '添加';
        $(function () {
            $('#option'+$status).parents('label').addClass('am-active')
            $('#option'+$status).attr('checked', 'checked');
            $('#thumb').fileupload({
                dataType: 'json',
                done: function (e, data) {
                    $('input[name="thumb"]').val(data.result.info)
                    $('.thumb').attr('src',data.result.info).show()
                }
            });
            $('#audio').fileupload({
                dataType: 'json',
                done: function (e, data) {
                    $('input[name="audio"]').val(data.result.info)
                    $('.audio').attr('src',data.result.info).show()
                }
            });

        })
        function addData(obj) {
            $.post("{$Think.ROOT_HOST}index.php?m={$Think.MODULE_NAME}&c={$Think.CONTROLLER_NAME}&a={$Think.ACTION_NAME}", obj.serialize(), function (json) {
                if (!json.s) {
                    alert(json.info)
                    return false;
                }
                alert($msg + '的ID：' + json.id)
                window.location.href = "{$Think.ROOT_HOST}index.php?m={$Think.MODULE_NAME}&c={$Think.CONTROLLER_NAME}&a=recommend_content&rid={$rInfo.id}"
            }, 'json');
            return false;
        }
    </script>
</block>